(function(t){function i(i){for(var a,d,r=i[0],o=i[1],n=i[2],u=0,l=[];u<r.length;u++)d=r[u],s[d]&&l.push(s[d][0]),s[d]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);c&&c(i);while(l.length)l.shift()();return h.push.apply(h,n||[]),e()}function e(){for(var t,i=0;i<h.length;i++){for(var e=h[i],a=!0,r=1;r<e.length;r++){var o=e[r];0!==s[o]&&(a=!1)}a&&(h.splice(i--,1),t=d(d.s=e[0]))}return t}var a={},s={app:0},h=[];function d(i){if(a[i])return a[i].exports;var e=a[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,d),e.l=!0,e.exports}d.m=t,d.c=a,d.d=function(t,i,e){d.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},d.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},d.t=function(t,i){if(1&i&&(t=d(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(d.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var a in t)d.d(e,a,function(i){return t[i]}.bind(null,a));return e},d.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return d.d(i,"a",i),i},d.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},d.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],o=r.push.bind(r);r.push=i,r=r.slice();for(var n=0;n<r.length;n++)i(r[n]);var c=o;h.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},1:function(t,i){},2:function(t,i){},3:function(t,i){},4:function(t,i){},"56d7":function(t,i,e){"use strict";e.r(i);e("cadf"),e("551c"),e("f751"),e("097d");var a=e("2b0e"),s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"web-camera-container",staticStyle:{width:"100%",height:"100%"},attrs:{id:"app"}},[t._v("\n  "+t._s(this.videoHeight)+"x"+t._s(this.videoWidth)+"\n  "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isCameraOpen&&t.isLoading,expression:"isCameraOpen && isLoading"}],staticClass:"camera-loading"},[t._m(0)]),t.isCameraOpen?e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"camera-box"},[e("canvas",{ref:"outputCanvas",attrs:{id:"outputCanvas"}}),e("video",{ref:"cameraInput",staticStyle:{display:"None"},attrs:{autoplay:""}}),e("vue-slider",t._b({staticStyle:{width:"75%"},model:{value:t.volume,callback:function(i){t.volume=i},expression:"volume"}},"vue-slider",t.sliderOptions,!1))],1):t._e()])},h=[function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("ul",{staticClass:"loader-circle"},[e("li"),e("li"),e("li")])}],d=(e("96cf"),e("3b8d")),r=(e("6aa2"),e("c2cf")),o=e("141c"),n=(e("68e4"),e("4971")),c=e.n(n),u=(e("24df"),{name:"app",components:{VueSlider:c.a},data:function(){return{isCameraOpen:!0,isLoading:!1,faceMesh:void 0,camera:void 0,link:"#",videoHeight:0,videoWidth:0,volume:100,sliderOptions:{dotSize:50,width:"auto",height:50,contained:!1,direction:"ltr",data:null,dataLabel:"label",dataValue:"value",min:0,max:100,interval:1,disabled:!1,clickable:!0,duration:.5,adsorb:!1,lazy:!1,tooltip:"active",tooltipPlacement:"top",tooltipFormatter:void 0,useKeyboard:!1,keydownHook:null,dragOnClick:!0,enableCross:!0,fixed:!1,minRange:void 0,maxRange:void 0,order:!0,marks:!1,dotOptions:{tooltip:"always"},dotAttrs:void 0,process:!0,dotStyle:void 0,railStyle:void 0,processStyle:void 0,tooltipStyle:void 0,stepStyle:void 0,stepActiveStyle:void 0,labelStyle:void 0,labelActiveStyle:void 0},canvasContext:void 0,sourceMat:void 0,destinMat:void 0,mapYGlobal:void 0,mapXGlobal:void 0,multiFaceLandmarks:void 0,videoCapture:void 0}},created:function(){this.createCameraElement()},methods:{liquify:function(){if(!this.multiFaceLandmarks)return this.sourceMat;for(var t=[this.multiFaceLandmarks[0][94].x*this.videoWidth,this.multiFaceLandmarks[0][94].y*this.videoHeight],i=30*this.volume/100,e=2,a=this.mapYGlobal.clone(),s=this.mapXGlobal.clone(),h=-1*i;h<i;h++)for(var d=-1*i;d<i;d++)h*h+d*d>i*i||(h>0&&(a.floatPtr(t[1]+h,t[0]+d)[0]=t[1]+Math.pow(h/i,e)*i),h<0&&(a.floatPtr(t[1]+h,t[0]+d)[0]=t[1]-Math.pow(-h/i,e)*i),d>0&&(s.floatPtr(t[1]+h,t[0]+d)[0]=t[0]+Math.pow(d/i,e)*i),d<0&&(s.floatPtr(t[1]+h,t[0]+d)[0]=t[0]-Math.pow(-d/i,e)*i));return this.$cv.remap(this.sourceMat,this.destinMat,s,a,this.$cv.INTER_LINEAR),a.delete(),s.delete(),this.destinMat},resize:function(){var t=30*this.volume/100,i=2*t;if(!this.multiFaceLandmarks)return this.sourceMat;var e=this.multiFaceLandmarks[0][94].x*this.videoWidth,a=this.multiFaceLandmarks[0][94].y*this.videoHeight;if(e>i&&e<this.sourceMat.cols-i&&a>i&&a<this.sourceMat.rows-i){this.destinMat=this.sourceMat.clone();var s=this.destinMat.roi(new this.$cv.Rect(e-t,a-t,2*t,2*t)),h=this.destinMat.roi(new this.$cv.Rect(e-2*t,a-2*t,4*t,4*t)),d=new this.$cv.Mat;return this.$cv.resize(s,d,new this.$cv.Size(2*s.cols,2*s.rows)),d.copyTo(h),d.delete(),s.delete(),h.delete(),this.destinMat}return this.sourceMat},cropContour:function(){if(!this.multiFaceLandmarks)return this.sourceMat;var t=10*this.volume/100;this.destinMat=this.sourceMat.clone();for(var i=[this.multiFaceLandmarks[0][0].x*this.videoWidth,this.multiFaceLandmarks[0][0].y*this.videoHeight,this.multiFaceLandmarks[0][267].x*this.videoWidth,this.multiFaceLandmarks[0][267].y*this.videoHeight,this.multiFaceLandmarks[0][269].x*this.videoWidth,this.multiFaceLandmarks[0][269].y*this.videoHeight,this.multiFaceLandmarks[0][270].x*this.videoWidth,this.multiFaceLandmarks[0][270].y*this.videoHeight,this.multiFaceLandmarks[0][409].x*this.videoWidth,this.multiFaceLandmarks[0][409].y*this.videoHeight,this.multiFaceLandmarks[0][287].x*this.videoWidth,this.multiFaceLandmarks[0][287].y*this.videoHeight,this.multiFaceLandmarks[0][375].x*this.videoWidth,this.multiFaceLandmarks[0][375].y*this.videoHeight,this.multiFaceLandmarks[0][321].x*this.videoWidth,this.multiFaceLandmarks[0][321].y*this.videoHeight,this.multiFaceLandmarks[0][405].x*this.videoWidth,this.multiFaceLandmarks[0][405].y*this.videoHeight,this.multiFaceLandmarks[0][314].x*this.videoWidth,this.multiFaceLandmarks[0][314].y*this.videoHeight,this.multiFaceLandmarks[0][17].x*this.videoWidth,this.multiFaceLandmarks[0][17].y*this.videoHeight,this.multiFaceLandmarks[0][84].x*this.videoWidth,this.multiFaceLandmarks[0][84].y*this.videoHeight,this.multiFaceLandmarks[0][181].x*this.videoWidth,this.multiFaceLandmarks[0][181].y*this.videoHeight,this.multiFaceLandmarks[0][91].x*this.videoWidth,this.multiFaceLandmarks[0][91].y*this.videoHeight,this.multiFaceLandmarks[0][146].x*this.videoWidth,this.multiFaceLandmarks[0][146].y*this.videoHeight,this.multiFaceLandmarks[0][57].x*this.videoWidth,this.multiFaceLandmarks[0][57].y*this.videoHeight,this.multiFaceLandmarks[0][185].x*this.videoWidth,this.multiFaceLandmarks[0][185].y*this.videoHeight,this.multiFaceLandmarks[0][40].x*this.videoWidth,this.multiFaceLandmarks[0][40].y*this.videoHeight,this.multiFaceLandmarks[0][39].x*this.videoWidth,this.multiFaceLandmarks[0][39].y*this.videoHeight,this.multiFaceLandmarks[0][37].x*this.videoWidth,this.multiFaceLandmarks[0][37].y*this.videoHeight],e=99999,a=99999,s=0,h=0,d=0;d<i.length;d++)d%2===0?(i[d]<e&&(e=i[d]),i[d]>s&&(s=i[d])):(i[d]<a&&(a=i[d]),i[d]>h&&(h=i[d]));for(var r=new this.$cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())),o=new this.$cv.MatVector,n=new this.$cv.Mat.zeros(20,2,this.$cv.CV_32S),c=0;c<40;c++)n.intPtr(0,c)[0]=i[c];var u=new this.$cv.Mat(h-a,s-e,this.$cv.CV_8UC4),l=new this.$cv.Mat(h-a+t,s-e,this.$cv.CV_8UC4),m=new this.$cv.Rect(e,a,s-e,h-a);u=this.sourceMat.roi(m);var v=new this.$cv.Size(s-e,h-a+t);this.$cv.resize(u,l,v,0,0,this.$cv.INTER_AREA);for(var p=e;p<s-1;p++)for(var f=a-t;f<h-1;f++){var k=this.$cv.pointPolygonTest(n,new this.$cv.Point(p,f),!0);k<0||(this.destinMat.ucharPtr(f,p)[0]=l.ucharPtr(f-a+t,p-e)[0],this.destinMat.ucharPtr(f,p)[1]=l.ucharPtr(f-a+t,p-e)[1],this.destinMat.ucharPtr(f,p)[2]=l.ucharPtr(f-a+t,p-e)[2],this.destinMat.ucharPtr(f,p)[3]=l.ucharPtr(f-a+t,p-e)[3])}return this.$cv.drawContours(this.destinMat,o,0,r,1),o.delete(),n.delete(),this.destinMat},cropContourOld:function(){if(!this.multiFaceLandmarks)return this.sourceMat;this.destinMat=this.sourceMat.clone();for(var t=[this.multiFaceLandmarks[0][0].x*this.videoWidth,this.multiFaceLandmarks[0][0].y*this.videoHeight,this.multiFaceLandmarks[0][267].x*this.videoWidth,this.multiFaceLandmarks[0][267].y*this.videoHeight,this.multiFaceLandmarks[0][269].x*this.videoWidth,this.multiFaceLandmarks[0][269].y*this.videoHeight,this.multiFaceLandmarks[0][270].x*this.videoWidth,this.multiFaceLandmarks[0][270].y*this.videoHeight,this.multiFaceLandmarks[0][409].x*this.videoWidth,this.multiFaceLandmarks[0][409].y*this.videoHeight,this.multiFaceLandmarks[0][287].x*this.videoWidth,this.multiFaceLandmarks[0][287].y*this.videoHeight,this.multiFaceLandmarks[0][375].x*this.videoWidth,this.multiFaceLandmarks[0][375].y*this.videoHeight,this.multiFaceLandmarks[0][321].x*this.videoWidth,this.multiFaceLandmarks[0][321].y*this.videoHeight,this.multiFaceLandmarks[0][405].x*this.videoWidth,this.multiFaceLandmarks[0][405].y*this.videoHeight,this.multiFaceLandmarks[0][314].x*this.videoWidth,this.multiFaceLandmarks[0][314].y*this.videoHeight,this.multiFaceLandmarks[0][17].x*this.videoWidth,this.multiFaceLandmarks[0][17].y*this.videoHeight,this.multiFaceLandmarks[0][84].x*this.videoWidth,this.multiFaceLandmarks[0][84].y*this.videoHeight,this.multiFaceLandmarks[0][181].x*this.videoWidth,this.multiFaceLandmarks[0][181].y*this.videoHeight,this.multiFaceLandmarks[0][91].x*this.videoWidth,this.multiFaceLandmarks[0][91].y*this.videoHeight,this.multiFaceLandmarks[0][146].x*this.videoWidth,this.multiFaceLandmarks[0][146].y*this.videoHeight,this.multiFaceLandmarks[0][57].x*this.videoWidth,this.multiFaceLandmarks[0][57].y*this.videoHeight,this.multiFaceLandmarks[0][185].x*this.videoWidth,this.multiFaceLandmarks[0][185].y*this.videoHeight,this.multiFaceLandmarks[0][40].x*this.videoWidth,this.multiFaceLandmarks[0][40].y*this.videoHeight,this.multiFaceLandmarks[0][39].x*this.videoWidth,this.multiFaceLandmarks[0][39].y*this.videoHeight,this.multiFaceLandmarks[0][37].x*this.videoWidth,this.multiFaceLandmarks[0][37].y*this.videoHeight],i=new this.$cv.MatVector,e=new this.$cv.Mat.zeros(20,2,this.$cv.CV_32S),a=0;a<40;a++)e.intPtr(0,a)[0]=t[a];i.push_back(e);var s=new this.$cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()));return this.$cv.drawContours(this.destinMat,i,0,s,1),i.delete(),e.delete(),this.destinMat},processVideo:function(){this.videoCapture.read(this.sourceMat);var t=this.cropContour(),i=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);this.canvasContext.clearRect(0,0,this.videoWidth,this.videoHeight),this.$refs.outputCanvas.width=i.width,this.$refs.outputCanvas.height=i.height,this.canvasContext.putImageData(i,0,0),requestAnimationFrame(this.processVideo)},onLandmarksDetected:function(t){this.multiFaceLandmarks=t.multiFaceLandmarks},createCameraElement:function(){var t=this;this.isLoading=!0,this.videoHeight=window.screen.height,this.videoWidth=window.screen.width;var i=window.constraints={audio:!1,video:{height:{max:500,ideal:this.videoWidth},width:{max:500,ideal:this.videoWidth}}};window.navigator.mediaDevices.getUserMedia(i).then(function(i){t.isLoading=!1,t.$refs.cameraInput.srcObject=i,t.canvasContext=t.$refs.outputCanvas.getContext("2d"),t.videoHeight=i.getVideoTracks()[0].getSettings().height,t.videoWidth=i.getVideoTracks()[0].getSettings().width,t.faceMesh=new r["FaceMesh"]({locateFile:function(t){return"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/".concat(t)}}),t.faceMesh.onResults(t.onLandmarksDetected),t.camera=new o["Camera"](t.$refs.cameraInput,{onFrame:function(){var i=Object(d["a"])(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.faceMesh.send({image:t.$refs.cameraInput});case 2:case"end":return i.stop()}},i,this)}));function e(){return i.apply(this,arguments)}return e}(),width:t.videoWidth,height:t.videoHeight}),t.camera.start(),t.$refs.cameraInput.setAttribute("width",t.videoWidth),t.$refs.cameraInput.setAttribute("height",t.videoHeight),console.log(t.videoWidth,t.videoHeight),t.videoCapture=new t.$cv.VideoCapture(t.$refs.cameraInput),t.sourceMat=new t.$cv.Mat(t.videoHeight,t.videoWidth,t.$cv.CV_8UC4),t.destinMat=new t.$cv.Mat(t.videoHeight,t.videoWidth,t.$cv.CV_8UC4),t.mapYGlobal=new t.$cv.Mat.zeros(t.videoHeight,t.videoWidth,t.$cv.CV_32F),t.mapXGlobal=new t.$cv.Mat.zeros(t.videoHeight,t.videoWidth,t.$cv.CV_32F);for(var e=0;e<t.videoHeight;e++)for(var a=0;a<t.videoWidth;a++)t.mapYGlobal.floatPtr(e,a)[0]=e,t.mapXGlobal.floatPtr(e,a)[0]=a;requestAnimationFrame(t.processVideo)}).catch(function(i){console.log(i),t.isLoading=!1,alert(i)})}}}),l=u,m=(e("5c0b"),e("2877")),v=Object(m["a"])(l,s,h,!1,null,null,null),p=v.exports,f=e("6d61");a["default"].config.productionTip=!1,a["default"].prototype.$cv=f;var k=0,g=setInterval(function(){k++;try{clearInterval(g),new a["default"]({render:function(t){return t(p)}}).$mount("#app")}catch(t){k>100&&clearInterval(g)}},25)},"5c0b":function(t,i,e){"use strict";var a=e("e332"),s=e.n(a);s.a},e332:function(t,i,e){}});
//# sourceMappingURL=app.2818ae5b.js.map